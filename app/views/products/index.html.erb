<h1>Каталог товарів</h1>

<!-- Поле пошуку -->
<div class="search-bar">
  <%= search_form_for @q, html: { class: "search-form" } do |f| %>
    <%= f.text_field :name_cont, placeholder: "Пошук за назвою", class: "form-control" %>
    <%= f.submit "Пошук", class: "btn btn-primary" %>
  <% end %>
</div>

<!-- Фільтри -->
<div class="filters">
  <%= form_with(url: products_path, method: :get, local: true, html: { id: 'filters-form', class: "filters-form" }) do |f| %>
    <div class="row">
      <!-- Фільтр за маркою -->
      <div class="col-md-4">
        <%= f.label :brand_id, "Марка:", class: "form-label" %>
        <%= f.select :brand_id, 
              options_from_collection_for_select(@brands, :id, :name, params[:brand_id]), 
              { include_blank: "Виберіть марку" }, 
              { class: "form-select select2", onchange: "this.form.submit();" } %>
      </div>

      <!-- Фільтр за моделлю -->
      <div class="col-md-4">
        <%= f.label :model_id, "Модель:", class: "form-label" %>
        <%= f.select :model_id, 
              options_from_collection_for_select(@models, :id, :name, params[:model_id]), 
              { include_blank: "Виберіть модель" }, 
              { class: "form-select select2" } %>
      </div>

      <!-- Фільтр за двигуном -->
      <div class="col-md-4">
        <%= f.label :engine_id, "Двигун:", class: "form-label" %>
        <%= f.select :engine_id, 
              options_from_collection_for_select(@engines, :id, :name, params[:engine_id]), 
              { include_blank: "Виберіть двигун" }, 
              { class: "form-select select2" } %>
      </div>
    </div>

    <div class="row mt-3">
      <!-- Фільтр за деталями -->
      <div class="col-md-6">
        <label for="part_id" class="form-label">Деталь:</label>
        <%= select_tag :part_id, 
              options_from_collection_for_select(@parts, :id, :name, params[:part_id]), 
              include_blank: "Виберіть деталь", 
              class: 'form-select select2' %>
      </div>

      <!-- Фільтр за характеристиками -->
      <div class="col-md-6">
        <label for="characteristic_ids" class="form-label">Характеристики:</label>
        <%= select_tag :characteristic_ids, 
              options_from_collection_for_select(@characteristics, :id, :name, params[:characteristic_ids]), 
              multiple: true, 
              class: 'form-select select2' %>
      </div>
    </div>

    <!-- Кнопка застосування фільтрів -->
    <div class="actions mt-4">
      <%= f.submit 'Застосувати фільтри', class: "btn btn-success w-100" %>
    </div>
  <% end %>
</div>

<!-- Список товарів -->
<div class="product-list row mt-5">
  <% if @products.present? %>
    <% @products.each do |product| %>
      <div class="col-md-4">
        <div class="product-item card mb-4">
          <div class="card-body">
            <h5 class="card-title"><%= link_to product.name, product_path(product), class: "text-decoration-none" %></h5>
            <p class="card-text"><%= truncate(product.description, length: 100) %></p>
            <p class="card-text"><strong>Ціна:</strong> <%= number_to_currency(product.price, unit: "грн", format: "%n %u") %></p>
            <%= button_to 'Додати в кошик', add_to_cart_path(product_id: product.id), method: :post, class: "btn btn-primary w-100" %>
          </div>
        </div>
      </div>
    <% end %>
  <% else %>
    <p class="text-center">Немає товарів, які відповідають заданим критеріям.</p>
  <% end %>
</div>
